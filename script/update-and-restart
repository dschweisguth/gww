#!/bin/sh

# This script updates production GWW from github. It's only meant for
# production; it does things that are only relevant in the production
# environment.

cd `dirname $0`/..
git fetch --tags
# TODO Dave use ruby, and eliminate tail
git checkout `git tag | perl -e 'print sort { substr($a, 6) <=> substr($b, 6) } <>' | tail -1`
# I thought Rails would do this on startup, but it doesn't seem to happen when
# running this script.
bundle install --deployment --without test
bundle exec rake RAILS_ENV=production db:migrate
touch tmp/restart.txt
rm -r public/cache
