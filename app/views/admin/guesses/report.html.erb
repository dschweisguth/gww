<%= render :partial => 'admin/breadcrumbs' %>
<hr/>
<h1>Score report</h1>

<a href="http://www.flickr.com/groups/guesswheresf/discuss/72157613300758288/">GWSF Scores discussion topic</a><br/><br/>

<textarea name="textfield" onFocus="this.select();" rows="50" style="width: 800px;" wrap="virtual">
&lt;b&gt;updated <%= @report_date.strftime '%A, %B %d, %I %p' %>&lt;/b&gt;

<%= pluralize @guesses.length, 'new guess' %> by ...

<% @guessers.each do |guesser| -%>
<% if @guesses_per_person[guesser.id] > 1 %>&lt;a href="#<%= @guesses_per_person[guesser.id] || 0 %>"&gt;<% end -%>&lt;b&gt;<%=h guesser.username %>&lt;/b&gt;<% if @guesses_per_person[guesser.id] > 1 %>&lt;/a&gt<% end %>
<% @guesses_by_guesser[guesser].each do |guess| -%>&lt;a href="<%= guess.photo.page_url %>">&lt;img height="50" width="50" src="<%= guess.photo.image_url "s" %>"&gt;&lt;/a&gt; <% end %>
<% end -%>

<% if ! @revelations_by_person.empty? -%>
<%= pluralize @revelations.length, 'photo' %> revealed by ...
<% @revelations_by_person.each do |revelations| -%>
&lt;b&gt;<%=h revelations[:person].username %>:&lt;/b&gt;
<% revelations[:revelations].each do |revelation| -%>&lt;a href="<%= revelation.photo.page_url %>">&lt;img height="50" width="50" src="<%= revelation.photo.image_url "s" %>"&gt;&lt;/a&gt; <% end %>
<% end -%>
<% end -%>

<% if ! @weekly_scores.empty? -%>
Top guessers in the last week: <% -%>
<% @weekly_scores.keys.sort { |x, y| y <=> x }.each_with_index do |score, score_index| -%>
<% @weekly_scores[score].each_with_index do |person, person_index| -%>
<% if score_index > 0 || person_index > 0 -%>, <% end -%><%= link_to person.username, show_person_url(person) %> (<%= score %>)<% -%>
<% end -%>
<% end -%>
<% end %>
<% if ! @monthly_scores.empty? -%>
Top guessers in the last month: <% -%>
<% @monthly_scores.keys.sort { |x, y| y <=> x }.each_with_index do |score, score_index| -%>
<% @monthly_scores[score].each_with_index do |person, person_index| -%>
<% if score_index > 0 || person_index > 0 -%>, <% end -%><%= link_to person.username, show_person_url(person) %> (<%= score %>)<% -%>
<% end -%>
<% end -%>
<% end %>

<%= pluralize @new_photos_count, 'photo' %> <%= singularize 'have', @new_photos_count %> been added to the pool since the last update. There are still &lt;a href="http://anythreewords.com/gwsf/"><%= @unfound_count %> unfound photos&lt;/a&gt; in the pool.

<%= @total_correct_guessers %> people have made correct guesses. <%= @total_posters_only %> people have put at least one photo in the pool but not guessed any photos correctly. That means that at least <%= @total_participants %> of our <%= pluralize @member_count, 'member' %> have participated in the game.

Since the beginning of the game, <%= @total_single_guessers %> people have guessed one photo correctly. Here are the <%= @total_correct_guessers - @total_single_guessers %> people who've correctly guessed two or more photos. In parentheses following each name is the number of photos that person has put in the pool.

<% @people_by_guess_count.each do |people_with_guess_count| -%>
<% next if people_with_guess_count[:guess_count] <= 1 -%>
&lt;a name="<%= people_with_guess_count[:guess_count] %>"&gt;&lt;b&gt;<%= people_with_guess_count[:guess_count] %>&lt;/b&gt;&lt;/a&gt; - <% people_with_guess_count[:people].each_with_index do |person, i| -%><%=h person.username %> (<%= @posts_per_person[person.id] || 0 %>)<% if i < people_with_guess_count[:people].length - 1 -%>, <% end -%><% end %>
<% end -%>

</textarea>

<hr/>
<%= render :partial => 'admin/breadcrumbs' %>
